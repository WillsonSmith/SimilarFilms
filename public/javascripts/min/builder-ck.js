var builder=function(){return{checkHash:function(e){var t,r=location.hash.split("/"),n;"#!"===r[0]?(t=confirm("Are you sure you want clear all current movies and add this new set?"),t?"#!"===r[0]&&(n=location.hash.substr(location.hash.indexOf("/")+1),localforage.setItem("favourites",JSON.parse(n),function(t){location.hash="",e()})):e()):e()},setData:function(e,t){var r=e.querySelector(".simLink"),n=e.querySelector(".title"),a=e.querySelector(".rating"),o=e.querySelector(".fav"),i=document.createElement("img"),u=t.title,l=t.id,c=t.rating,s="http://image.tmdb.org/t/p/w300/",d=t.posterURL;return i.src=s+d,r.appendChild(i),r.setAttribute("href","/similar/"+l),o.setAttribute("data-film",u),o.setAttribute("data-id",l),o.setAttribute("data-rating",c),o.setAttribute("data-image",d),n.innerHTML=u,a.innerHTML=c,e},makeResult:function(e){var t=e.cloneNode(!0),r,n,a=document.createDocumentFragment(),o=document.getElementById("resultId");builder.checkHash(function(){localforage.getItem("favourites",function(n){var i=document.querySelector(".result"),u;n&&(u=n.extraData),document.getElementById("resultId").removeChild(e);for(var l in u)if(u.hasOwnProperty(l)){var c=u[l];r=t.cloneNode(!0),builder.setData(r,c),a.appendChild(r)}o.appendChild(a),setup.init()})})},prepEvents:function(){document.getElementById("deleteData").addEventListener("click",function(){var e=confirm("Are you sure you want to remove all movies?");e&&localforage.removeItem("favourites").then(function(){document.location.reload(!0)})},!1),document.getElementById("backupMovies").addEventListener("click",function(){localforage.getItem("favourites",function(e){var t=document.querySelector(".result"),r;e&&(e=JSON.stringify(e),document.getElementById("textareaLink").value="http://similarfilms.com/mine/#!/"+e,location.hash="textareaLink")})},!1)}}}();builder.prepEvents(),builder.makeResult(document.querySelector(".result"));