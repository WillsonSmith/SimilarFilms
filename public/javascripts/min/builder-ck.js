var builder=function(){return{checkHash:function(e){var t,r=location.hash.split("/"),a;"#!"===r[0]?(t=confirm("Are you sure you want clear all current movies and add this new set?"),t?"#!"===r[0]&&(a=location.hash.substr(location.hash.indexOf("/")+1),localforage.setItem("favourites",JSON.parse(a),function(t){location.hash="",e()})):e()):e()},setData:function(e,t){var r=e.querySelector(".simLink"),a=e.querySelector(".title"),n=e.querySelector(".rating"),o=e.querySelector(".fav"),i=document.createElement("img"),u=t.title,l=t.id,c=t.rating,d="http://image.tmdb.org/t/p/w300/",s=t.posterURL;return i.src=d+s,r.appendChild(i),r.setAttribute("href","/similar/"+l),o.setAttribute("data-film",u),o.setAttribute("data-id",l),o.setAttribute("data-rating",c),o.setAttribute("data-image",s),a.innerHTML=u,n.innerHTML=c,e},makeResult:function(e){var t=e.cloneNode(!0),r,a,n=document.createDocumentFragment(),o=document.getElementById("resultId");builder.checkHash(function(){localforage.getItem("favourites",function(a){var i=document.querySelector(".result"),u;a&&(u=a.extraData),document.getElementById("resultId").removeChild(e);for(var l in u)if(u.hasOwnProperty(l)){var c=u[l];r=t.cloneNode(!0),builder.setData(r,c),n.appendChild(r)}o.appendChild(n)})})},prepEvents:function(){document.getElementById("deleteData").addEventListener("click",function(){var e=confirm("Are you sure you want to remove all movies?");e&&localforage.removeItem("favourites").then(function(){document.location.reload(!0)})},!1),document.getElementById("backupMovies").addEventListener("click",function(){localforage.getItem("favourites",function(e){var t=document.querySelector(".result"),r;e&&(e=JSON.stringify(e),document.getElementById("textareaLink").value="http://similarfilms.com/mine/#!/"+e,location.hash="textareaLink")})},!1)}}}();builder.prepEvents(),builder.makeResult(document.querySelector(".result"));